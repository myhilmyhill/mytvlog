<!DOCTYPE html>
<html lang="ja">

<title>mytvlog</title>
<script src="{{ url_for('static', path='marker-plot.js') }}"></script>
<script>
  async function setWatched(id) {
    await fetch('/api/watched', {
      headers: { 'Content-Type': 'application/json' },
      method: 'POST',
      body: JSON.stringify({ recording_id: id, move_file: true }),
    })
  }
</script>

<a href="/programs">Programs</a>
<a href="/recordings">Recordings</a>
<a href="/views">Views</a>

<table>
{% for item in agg %}
    <tr><td><marker-plot
      min="{{ item.start_time }}"
      max="{{ item.start_time + item.duration }}"
      data="[{{ item.views or '' }}]"
      width="{{ 5 * 60 * 2 }}">
    </marker-plot></td>
    <td>
    {% for rec_id, watched in rec_zip(item.id) %}
      <button onclick="setWatched({{ rec_id }})">{{ watched }}</button>
    {% endfor %}
    </td>
    <td>{{ item.start_time_string }}</td><td>{{ item.name }}</td>
{% endfor %}
</table>

</html>
